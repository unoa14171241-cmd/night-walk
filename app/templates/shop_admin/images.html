{% extends "base.html" %}

{% block title %}ç”»åƒç®¡ç† - {{ shop.name }} - Night-Walk{% endblock %}

{% block content %}
<div class="container container-md">
    <p class="mb-3">
        <a href="{{ url_for('shop_admin.edit') }}">â† åº—èˆ—æƒ…å ±ç·¨é›†ã«æˆ»ã‚‹</a>
    </p>
    
    <div class="card mb-4">
        <div class="card-header">
            <h1 class="card-title">ç”»åƒç®¡ç†</h1>
            <p class="text-muted mb-0">{{ shop.name }}</p>
        </div>
        
        <!-- Upload Form -->
        <form method="POST" 
              action="{{ url_for('shop_admin.upload_image') }}" 
              enctype="multipart/form-data"
              class="mb-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <div class="upload-area" id="upload-area">
                <input type="file" 
                       id="image" 
                       name="image" 
                       accept="image/png,image/jpeg,image/gif,image/webp"
                       class="upload-input"
                       required>
                <div class="upload-content">
                    <span class="upload-icon">ğŸ“·</span>
                    <p class="upload-text">ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã§ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</p>
                    <p class="upload-hint">PNG, JPG, GIF, WEBPï¼ˆæœ€å¤§5MBï¼‰</p>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary mt-3">
                ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            </button>
        </form>
    </div>
    
    <!-- Current Images -->
    <div class="card">
        <h3 class="mb-3">ç™»éŒ²æ¸ˆã¿ç”»åƒï¼ˆ{{ images | length }}æšï¼‰</h3>
        
        {% if images %}
        <div class="image-grid" id="image-grid">
            {% for image in images %}
            <div class="image-item" data-id="{{ image.id }}">
                <div class="image-preview">
                    <img src="{{ image.url }}" alt="{{ image.original_filename }}">
                    {% if image.is_main %}
                    <span class="image-main-badge">ãƒ¡ã‚¤ãƒ³</span>
                    {% endif %}
                </div>
                <div class="image-actions">
                    {% if not image.is_main %}
                    <form method="POST" action="{{ url_for('shop_admin.set_main_image', image_id=image.id) }}" style="display: inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm btn-secondary" title="ãƒ¡ã‚¤ãƒ³ã«è¨­å®š">
                            â˜…
                        </button>
                    </form>
                    {% endif %}
                    <form method="POST" 
                          action="{{ url_for('shop_admin.delete_image', image_id=image.id) }}" 
                          style="display: inline;"
                          onsubmit="return confirm('ã“ã®ç”»åƒã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm btn-danger" title="å‰Šé™¤">
                            ğŸ—‘
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <p class="text-muted mt-3" style="font-size: 0.75rem;">
            â€» â˜…ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ¡ã‚¤ãƒ³ç”»åƒã«è¨­å®šã•ã‚Œã¾ã™<br>
            â€» ãƒ¡ã‚¤ãƒ³ç”»åƒã¯åº—èˆ—ä¸€è¦§ã®ã‚µãƒ ãƒã‚¤ãƒ«ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™
        </p>
        {% else %}
        <p class="text-muted text-center">ã¾ã ç”»åƒãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
        {% endif %}
    </div>
</div>

<style>
.upload-area {
    position: relative;
    border: 2px dashed var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-2xl);
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-base);
}

.upload-area:hover {
    border-color: var(--color-primary);
    background: rgba(201, 169, 98, 0.05);
}

.upload-area.dragover {
    border-color: var(--color-primary);
    background: rgba(201, 169, 98, 0.1);
}

.upload-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
}

.upload-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: var(--space-md);
}

.upload-text {
    margin-bottom: var(--space-sm);
    font-weight: 500;
}

.upload-hint {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    margin: 0;
}

.image-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: var(--space-md);
}

.image-item {
    position: relative;
    background: var(--color-bg-elevated);
    border-radius: var(--radius-md);
    overflow: hidden;
}

.image-preview {
    position: relative;
    aspect-ratio: 1;
}

.image-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.image-main-badge {
    position: absolute;
    top: var(--space-sm);
    left: var(--space-sm);
    background: var(--color-primary);
    color: var(--color-bg-dark);
    padding: 2px 8px;
    border-radius: var(--radius-sm);
    font-size: 0.7rem;
    font-weight: 600;
}

.image-actions {
    display: flex;
    justify-content: center;
    gap: var(--space-sm);
    padding: var(--space-sm);
}
</style>

{% block extra_js %}
<script>
// Drag and drop handling
const uploadArea = document.getElementById('upload-area');
const uploadInput = document.getElementById('image');

['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    uploadArea.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
}

['dragenter', 'dragover'].forEach(eventName => {
    uploadArea.addEventListener(eventName, () => {
        uploadArea.classList.add('dragover');
    }, false);
});

['dragleave', 'drop'].forEach(eventName => {
    uploadArea.addEventListener(eventName, () => {
        uploadArea.classList.remove('dragover');
    }, false);
});

uploadArea.addEventListener('drop', (e) => {
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        uploadInput.files = files;
    }
}, false);

// Preview filename
uploadInput.addEventListener('change', function() {
    if (this.files.length > 0) {
        document.querySelector('.upload-text').textContent = this.files[0].name;
    }
});
</script>
{% endblock %}
{% endblock %}
