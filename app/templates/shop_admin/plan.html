{% extends "base.html" %}

{% block title %}ãƒ—ãƒ©ãƒ³çŠ¶æ³ - {{ shop.name }} - Night-Walk{% endblock %}

{% block content %}
<div class="shop-admin-layout">
    <div class="shop-admin-content">
        <div class="d-flex justify-between align-center mb-4">
            <h1 class="mb-0">ãƒ—ãƒ©ãƒ³çŠ¶æ³</h1>
            <span class="text-muted">{{ shop.name }}</span>
        </div>
        
        <!-- ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ -->
        <div class="card mb-4">
            <div class="plan-card">
                <div class="plan-header">
                    {% if store_plan.plan_type == 'premium' %}
                    <span class="plan-badge premium">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </span>
                    {% elif store_plan.plan_type == 'standard' %}
                    <span class="plan-badge standard">ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰</span>
                    {% else %}
                    <span class="plan-badge free">ç„¡æ–™ãƒ—ãƒ©ãƒ³</span>
                    {% endif %}
                </div>
                
                <div class="plan-details">
                    <div class="plan-price">
                        {% if store_plan.monthly_price > 0 %}
                        <span class="price">Â¥{{ '{:,}'.format(store_plan.monthly_price) }}</span>
                        <span class="period">/æœˆ</span>
                        {% else %}
                        <span class="price">ç„¡æ–™</span>
                        {% endif %}
                    </div>
                    
                    <div class="plan-status">
                        {% if store_plan.is_active %}
                        <span class="badge badge-success">æœ‰åŠ¹</span>
                        {% if store_plan.is_trial %}
                        <span class="badge badge-warning">ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­ï¼ˆæ®‹ã‚Š{{ store_plan.days_until_trial_ends }}æ—¥ï¼‰</span>
                        {% endif %}
                        {% else %}
                        <span class="badge badge-danger">ç„¡åŠ¹</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="plan-features mt-4">
                    <h4>ã“ã®ãƒ—ãƒ©ãƒ³ã§åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½</h4>
                    <ul class="feature-list">
                        {% if 'search_boost' in plan_features.get(store_plan.plan_type, []) %}
                        <li class="enabled">âœ“ æ¤œç´¢çµæœã§ã®å„ªå…ˆè¡¨ç¤º</li>
                        {% else %}
                        <li class="disabled">âœ— æ¤œç´¢çµæœã§ã®å„ªå…ˆè¡¨ç¤º</li>
                        {% endif %}
                        
                        {% if 'premium_badge' in plan_features.get(store_plan.plan_type, []) %}
                        <li class="enabled">âœ“ å„ªè‰¯åº—ãƒãƒƒã‚¸è¡¨ç¤º</li>
                        {% else %}
                        <li class="disabled">âœ— å„ªè‰¯åº—ãƒãƒƒã‚¸è¡¨ç¤º</li>
                        {% endif %}
                        
                        {% if 'job_board' in plan_features.get(store_plan.plan_type, []) %}
                        <li class="enabled">âœ“ æ±‚äººæƒ…å ±æ²è¼‰</li>
                        {% else %}
                        <li class="disabled">âœ— æ±‚äººæƒ…å ±æ²è¼‰</li>
                        {% endif %}
                        
                        {% if 'cast_display' in plan_features.get(store_plan.plan_type, []) %}
                        <li class="enabled">âœ“ ã‚­ãƒ£ã‚¹ãƒˆå‡ºå‹¤è¡¨ç¤º</li>
                        {% else %}
                        <li class="disabled">âœ— ã‚­ãƒ£ã‚¹ãƒˆå‡ºå‹¤è¡¨ç¤º</li>
                        {% endif %}
                        
                        {% if 'top_banner' in plan_features.get(store_plan.plan_type, []) %}
                        <li class="enabled">âœ“ ãƒˆãƒƒãƒ—ãƒãƒŠãƒ¼æ²è¼‰æ¨©</li>
                        {% else %}
                        <li class="disabled">âœ— ãƒˆãƒƒãƒ—ãƒãƒŠãƒ¼æ²è¼‰æ¨©</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- ç¾åœ¨ã®ãƒãƒƒã‚¸ãƒ»ç‰¹å…¸ -->
        <div class="card mb-4">
            <h3 class="mb-3">ğŸ† ç¾åœ¨ã®ãƒãƒƒã‚¸ãƒ»ç‰¹å…¸</h3>
            
            {% if badges.premium_badge %}
            <div class="badge-display premium mb-3">
                <span class="badge-icon">â­</span>
                <span class="badge-label">å„ªè‰¯åº—</span>
                <small class="text-muted">æœ‰æ–™ãƒ—ãƒ©ãƒ³ç‰¹å…¸</small>
            </div>
            {% endif %}
            
            {% if badges.top_badges %}
            {% for badge in badges.top_badges %}
            <div class="badge-display top{{ badge.rank }} mb-3">
                <span class="badge-icon">ğŸ…</span>
                <span class="badge-label">{{ badge.area }} TOP{{ badge.rank }}</span>
                <small class="text-muted">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç‰¹å…¸</small>
            </div>
            {% endfor %}
            {% endif %}
            
            {% if not badges.premium_badge and not badges.top_badges %}
            <p class="text-muted">ç¾åœ¨ç²å¾—ã—ã¦ã„ã‚‹ãƒãƒƒã‚¸ãƒ»ç‰¹å…¸ã¯ã‚ã‚Šã¾ã›ã‚“</p>
            {% endif %}
        </div>
        
        <!-- æœ‰åŠ¹ãªåºƒå‘Šæ¨©åˆ© -->
        <div class="card">
            <h3 class="mb-3">ğŸ“‹ æœ‰åŠ¹ãªåºƒå‘Šæ¨©åˆ©</h3>
            
            {% if entitlements %}
            <table class="table">
                <thead>
                    <tr>
                        <th>æ¨©åˆ©ã‚¿ã‚¤ãƒ—</th>
                        <th>ã‚¨ãƒªã‚¢</th>
                        <th>æœ‰åŠ¹æœŸé™</th>
                        <th>æ®‹ã‚Š</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ent in entitlements %}
                    <tr>
                        <td>{{ ent.placement_label }}</td>
                        <td>{{ ent.area or 'å…¨ã‚¨ãƒªã‚¢' }}</td>
                        <td>{{ ent.ends_at.strftime('%Y/%m/%d') }}</td>
                        <td>
                            {% if ent.days_remaining > 0 %}
                            {{ ent.days_remaining }}æ—¥
                            {% else %}
                            <span class="text-warning">æœ¬æ—¥ã¾ã§</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted">æœ‰åŠ¹ãªåºƒå‘Šæ¨©åˆ©ã¯ã‚ã‚Šã¾ã›ã‚“</p>
            {% endif %}
        </div>
        
        <!-- ãƒ—ãƒ©ãƒ³å¤‰æ›´ã®æ¡ˆå†… -->
        {% if store_plan.plan_type == 'free' %}
        <div class="card mt-4 upgrade-prompt">
            <h3>ğŸš€ ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã›ã‚“ã‹ï¼Ÿ</h3>
            <p>æœ‰æ–™ãƒ—ãƒ©ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€æ¤œç´¢ã§ã®å„ªå…ˆè¡¨ç¤ºã‚„å„ªè‰¯åº—ãƒãƒƒã‚¸ãªã©ã€<br>é›†å®¢ã«å½¹ç«‹ã¤æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚</p>
            <a href="mailto:support@night-walk.jp?subject=ãƒ—ãƒ©ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«ã¤ã„ã¦" class="btn btn-primary">
                ãŠå•ã„åˆã‚ã›
            </a>
        </div>
        {% endif %}
    </div>
</div>

<style>
.plan-card {
    text-align: center;
    padding: 2rem;
}
.plan-header {
    margin-bottom: 1.5rem;
}
.plan-badge {
    display: inline-block;
    padding: 0.5rem 1.5rem;
    border-radius: 2rem;
    font-size: 1.25rem;
    font-weight: 600;
}
.plan-badge.premium {
    background: linear-gradient(135deg, #ffd700, #ff8c00);
    color: #000;
}
.plan-badge.standard {
    background: linear-gradient(135deg, #4a90d9, #357abd);
    color: #fff;
}
.plan-badge.free {
    background: var(--color-bg-elevated);
    color: var(--color-text-muted);
}

.plan-price .price {
    font-size: 2.5rem;
    font-weight: 700;
}
.plan-price .period {
    color: var(--color-text-muted);
}

.feature-list {
    list-style: none;
    padding: 0;
    text-align: left;
    max-width: 300px;
    margin: 0 auto;
}
.feature-list li {
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--color-border);
}
.feature-list li.enabled {
    color: var(--color-success);
}
.feature-list li.disabled {
    color: var(--color-text-muted);
}

.badge-display {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: var(--color-bg-elevated);
    border-radius: var(--radius);
}
.badge-display.premium {
    background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,140,0,0.2));
    border: 1px solid #ffd700;
}
.badge-display.top1 {
    background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,215,0,0.1));
    border: 2px solid #ffd700;
}
.badge-display.top2, .badge-display.top3 {
    background: linear-gradient(135deg, rgba(192,192,192,0.3), rgba(192,192,192,0.1));
    border: 1px solid #c0c0c0;
}
.badge-icon {
    font-size: 1.5rem;
}
.badge-label {
    font-weight: 600;
}

.upgrade-prompt {
    background: linear-gradient(135deg, var(--color-primary-bg), transparent);
    border: 1px solid var(--color-primary);
    text-align: center;
    padding: 2rem;
}
</style>
{% endblock %}
