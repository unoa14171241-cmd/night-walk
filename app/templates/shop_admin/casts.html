{% extends "base.html" %}

{% block title %}キャスト管理 - {{ shop.name }} - Night-Walk{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="page-header">
        <div>
            <a href="{{ url_for('shop_admin.dashboard') }}" class="back-link">← ダッシュボードに戻る</a>
            <h1>キャスト管理</h1>
            <p class="text-muted">{{ shop.name }}</p>
        </div>
        <a href="{{ url_for('shop_admin.new_cast') }}" class="btn btn-primary">新規キャスト登録</a>
    </div>
    
    {% if pending_casts %}
    <div class="card mb-4" style="border-left: 4px solid var(--color-warning);">
        <h3 class="mb-3">承認待ちキャスト（{{ pending_casts|length }}件）</h3>
        {% for pc in pending_casts %}
        <div class="d-flex justify-between align-center mb-2 p-2" style="background: #fffbe6; border-radius: 4px;">
            <div>
                <strong>{{ pc.name_display }}</strong>
                <small class="text-muted ms-2">（登録名: {{ pc.name }}）</small>
            </div>
            <div class="d-flex gap-2">
                <form method="POST" action="{{ url_for('shop_admin.approve_cast', cast_id=pc.id) }}" style="display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="action" value="approve">
                    <button type="submit" class="btn btn-sm btn-primary">承認</button>
                </form>
                <form method="POST" action="{{ url_for('shop_admin.approve_cast', cast_id=pc.id) }}" style="display:inline;"
                      onsubmit="return confirm('この登録を拒否しますか？')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="action" value="reject">
                    <button type="submit" class="btn btn-sm btn-danger">拒否</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if casts %}
    <div class="cast-list">
        {% for cast in casts %}
        <div class="cast-card">
            <div class="cast-card-image">
                <img src="{{ cast.image_url }}" alt="{{ cast.name_display }}">
            </div>
            <div class="cast-card-body">
                <div class="cast-card-header">
                    <h3 class="cast-name">{{ cast.name_display }}</h3>
                    {% if not cast.is_active %}
                    <span class="badge badge-secondary">非公開</span>
                    {% endif %}
                    {% if cast.is_featured %}
                    <span class="badge badge-warning">注目</span>
                    {% endif %}
                </div>
                <div class="cast-stats">
                    <span>ギフト: {{ cast.total_gifts_received | default(0) }}件</span>
                    <span>収益: ¥{{ cast.total_earnings | default(0) | int }}</span>
                </div>
                <div class="cast-status">
                    {% if cast.is_accepting_gifts %}
                    <span class="badge badge-success">ギフト受付中</span>
                    {% else %}
                    <span class="badge badge-secondary">ギフト停止中</span>
                    {% endif %}
                </div>
            </div>
            <div class="cast-card-actions">
                <a href="{{ url_for('shop_admin.edit_cast', cast_id=cast.id) }}" class="btn btn-sm btn-secondary">編集</a>
                <form action="{{ url_for('shop_admin.delete_cast', cast_id=cast.id) }}" method="POST" 
                      style="display: inline;" onsubmit="return confirm('本当に削除しますか？')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-sm btn-danger">削除</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <p>まだキャストが登録されていません</p>
        <a href="{{ url_for('shop_admin.new_cast') }}" class="btn btn-primary">最初のキャストを登録</a>
    </div>
    {% endif %}
</div>
{% endblock %}
