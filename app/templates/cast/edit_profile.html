{% extends "cast/base.html" %}

{% block title %}ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† - Night-Walk{% endblock %}

{% block content %}
<div class="container" style="max-width: 600px; padding: var(--space-lg);">
    <h1 class="mb-4">ğŸ“ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h1>
    
    <form method="POST" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <!-- è‡ªå·±ç´¹ä»‹ -->
        <div class="card mb-4">
            <h3 class="mb-3">è‡ªå·±ç´¹ä»‹</h3>
            <div class="form-group">
                <textarea name="profile" class="form-control" rows="5">{{ cast.profile or '' }}</textarea>
            </div>
        </div>
        
        <!-- ã‚¿ã‚° -->
        <div class="card mb-4">
            <h3 class="mb-3">ğŸ·ï¸ ã‚¿ã‚°ä»˜ã‘</h3>
            <p class="text-muted mb-3" style="font-size: 0.85rem;">ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰é¸æŠã™ã‚‹ã‹ã€è‡ªç”±ã«å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ã€‚</p>
            
            {% for category in tag_categories %}
            <div class="form-group" style="margin-bottom: var(--space-md);">
                <label>{{ tag_category_labels[category] }}</label>
                <input type="text" name="tags_{{ category }}" class="form-control" 
                       id="tags_{{ category }}"
                       value="{% if existing_tags is defined and category in existing_tags %}{{ existing_tags[category] | map(attribute='name') | join(', ') }}{% endif %}"
                       placeholder="ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›">
                {% if category in preset_tags %}
                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px;">
                    {% for tag_name in preset_tags[category] %}
                    <button type="button" class="preset-tag-btn" 
                            onclick="addTag('tags_{{ category }}', '{{ tag_name }}')">{{ tag_name }}</button>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <!-- ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”»åƒ -->
        <div class="card mb-4">
            <h3 class="mb-3">ğŸ“· ã‚®ãƒ£ãƒ©ãƒªãƒ¼å†™çœŸ</h3>
            {% if gallery %}
            <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: var(--space-md);">
                {% for img in gallery %}
                <div style="width: 100px;">
                    <img src="{{ img.url }}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 0.75rem; margin-top: 4px; color: var(--color-danger); cursor: pointer;">
                        <input type="checkbox" name="delete_gallery_image" value="{{ img.id }}"> å‰Šé™¤
                    </label>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <div class="form-group">
                <input type="file" name="gallery_images" class="form-control" accept="image/*" multiple>
                <small class="form-help">è¤‡æ•°é¸æŠå¯</small>
            </div>
        </div>
        
        <!-- ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”» -->
        <div class="card mb-4">
            <h3 class="mb-3">ğŸ¬ ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»</h3>
            <div class="form-group">
                <input type="url" name="video_url" class="form-control" 
                       value="{{ cast.video_url or '' }}"
                       placeholder="https://www.youtube.com/shorts/...">
                <small class="form-help">YouTube Shortsã€TikTokã€Instagram Reelsç­‰ã®URL</small>
            </div>
        </div>
        
        <!-- SNS -->
        <div class="card mb-4">
            <h3 class="mb-3">ğŸ“± SNS</h3>
            <div class="form-group">
                <label>X (Twitter)</label>
                <input type="url" name="twitter_url" class="form-control" 
                       value="{{ cast.twitter_url or '' }}" placeholder="https://x.com/username">
            </div>
            <div class="form-group">
                <label>Instagram</label>
                <input type="url" name="instagram_url" class="form-control" 
                       value="{{ cast.instagram_url or '' }}" placeholder="https://instagram.com/username">
            </div>
            <div class="form-group">
                <label>TikTok</label>
                <input type="url" name="tiktok_url" class="form-control" 
                       value="{{ cast.tiktok_url or '' }}" placeholder="https://tiktok.com/@username">
            </div>
        </div>
        
        <!-- ã‚®ãƒ•ãƒˆã¸ã®æ„æ°—è¾¼ã¿ -->
        <div class="card mb-4">
            <h3 class="mb-3">ğŸ’Œ ã‚®ãƒ•ãƒˆã¸ã®æ„æ°—è¾¼ã¿</h3>
            <div class="form-group">
                <textarea name="gift_appeal" class="form-control" rows="3"
                          placeholder="ä¾‹: çš†ã•ã¾ã‹ã‚‰ã®ã‚®ãƒ•ãƒˆãŒåŠ±ã¿ã«ãªã‚Šã¾ã™ï¼">{{ cast.gift_appeal or '' }}</textarea>
                <small class="form-help">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã‚®ãƒ•ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¡¨ç¤ºã•ã‚Œã¾ã™</small>
            </div>
        </div>
        
        <!-- èª•ç”Ÿæ—¥ -->
        <div class="card mb-4">
            <h3 class="mb-3">ğŸ‚ èª•ç”Ÿæ—¥ãƒ»è¨˜å¿µæ—¥</h3>
            <div id="birthday-container">
                {% if existing_birthdays %}
                {% for bd in existing_birthdays %}
                <div class="birthday-row d-flex gap-2 mb-2" style="align-items: center;">
                    <input type="text" name="birthday_date" class="form-control" 
                           value="{{ bd.birthday_month }}-{{ bd.birthday_day }}" 
                           placeholder="æœˆ-æ—¥" style="max-width: 120px;">
                    <input type="text" name="birthday_label" class="form-control" 
                           value="{{ bd.label or '' }}" placeholder="ãƒ©ãƒ™ãƒ«" style="max-width: 160px;">
                    <button type="button" class="btn btn-sm btn-danger" onclick="this.parentElement.remove()">âœ•</button>
                </div>
                {% endfor %}
                {% else %}
                <div class="birthday-row d-flex gap-2 mb-2" style="align-items: center;">
                    <input type="text" name="birthday_date" class="form-control" placeholder="æœˆ-æ—¥ï¼ˆä¾‹: 3-15ï¼‰" style="max-width: 120px;">
                    <input type="text" name="birthday_label" class="form-control" placeholder="ãƒ©ãƒ™ãƒ«" style="max-width: 160px;">
                    <button type="button" class="btn btn-sm btn-danger" onclick="this.parentElement.remove()">âœ•</button>
                </div>
                {% endif %}
            </div>
            <button type="button" class="btn btn-sm btn-outline" onclick="addBirthdayRow()">ï¼‹ è¿½åŠ </button>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary" style="width: 100%;">æ›´æ–°ã™ã‚‹</button>
        </div>
        
        <div style="text-align: center; margin-top: var(--space-md);">
            <a href="{{ url_for('cast.profile') }}">â† ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«æˆ»ã‚‹</a>
        </div>
    </form>
</div>

<style>
.preset-tag-btn {
    background: var(--color-bg-elevated);
    border: 1px solid var(--color-border);
    border-radius: 16px;
    padding: 4px 10px;
    font-size: 0.75rem;
    cursor: pointer;
    color: var(--color-text);
}
.preset-tag-btn:hover {
    background: var(--color-primary);
    color: #fff;
    border-color: var(--color-primary);
}
</style>

<script>
function addTag(inputId, tagName) {
    const input = document.getElementById(inputId);
    const current = input.value.split(',').map(t => t.trim()).filter(t => t);
    if (!current.includes(tagName)) {
        current.push(tagName);
        input.value = current.join(', ');
    }
}

function addBirthdayRow() {
    const container = document.getElementById('birthday-container');
    const row = document.createElement('div');
    row.className = 'birthday-row d-flex gap-2 mb-2';
    row.style.alignItems = 'center';
    row.innerHTML = `
        <input type="text" name="birthday_date" class="form-control" placeholder="æœˆ-æ—¥ï¼ˆä¾‹: 3-15ï¼‰" style="max-width: 120px;">
        <input type="text" name="birthday_label" class="form-control" placeholder="ãƒ©ãƒ™ãƒ«" style="max-width: 160px;">
        <button type="button" class="btn btn-sm btn-danger" onclick="this.parentElement.remove()">âœ•</button>
    `;
    container.appendChild(row);
}
</script>
{% endblock %}
