{% extends "customer/base.html" %}

{% block title %}Night-Walk - å²¡å±±ãƒ»å€‰æ•·ã®ãƒŠã‚¤ãƒˆã‚¹ãƒãƒƒãƒˆæ¤œç´¢{% endblock %}

{% block content %}
<div class="container">
    <!-- Top Banner Ads (Carousel) -->
    {% if top_ads %}
    <div class="banner-carousel mb-4">
        {% for ad in top_ads %}
        <a href="{{ url_for('public.ad_click', ad_id=ad.id) }}" 
           class="banner-item {% if loop.first %}active{% endif %}"
           target="_blank"
           rel="noopener">
            {% if ad.display_image_url %}
            <img src="{{ ad.display_image_url }}" alt="{{ ad.title }}">
            {% else %}
            <div class="banner-placeholder">
                <span>{{ ad.title }}</span>
            </div>
            {% endif %}
        </a>
        {% endfor %}
        {% if top_ads | length > 1 %}
        <div class="banner-dots">
            {% for ad in top_ads %}
            <span class="dot {% if loop.first %}active{% endif %}" data-index="{{ loop.index0 }}"></span>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Search Section -->
    <div class="search-section">
        <div class="search-hero">
            <h1 class="search-title">
                âœ¨ å²¡å±±ãƒ»å€‰æ•·ã®ãƒŠã‚¤ãƒˆã‚¹ãƒãƒƒãƒˆ âœ¨
            </h1>
        </div>
        
        <!-- ç›®çš„åˆ¥é¸æŠï¼ˆã‚·ãƒ¼ãƒ³é¸æŠï¼‰ -->
        <div class="scene-selection">
            <div class="scene-cards">
                {% for scene_key in scenes %}
                {% set scene = scene_groups[scene_key] %}
                <a href="{{ url_for('public.search', scene=scene_key) }}" 
                   class="scene-card" 
                   style="--scene-color: {{ scene.color }}">
                    <div class="scene-content">
                        <div class="scene-name">{{ scene.name }}</div>
                        <div class="scene-desc">{{ scene.description }}</div>
                    </div>
                    <div class="scene-arrow">â†’</div>
                </a>
                {% endfor %}
            </div>
        </div>
        
        <!-- Feature Ribbons -->
        <div class="feature-ribbons feature-ribbons-inline">
            <span class="ribbon">â˜…é«˜å¾…é‡ã®ãŠä»•äº‹</span>
            <span class="ribbon">â˜…ä½“å…¥æ­“è¿</span>
            <span class="ribbon">â˜…é€è¿ã‚ã‚Š</span>
        </div>
        
        <!-- Keyword Search -->
        <form action="{{ url_for('public.search') }}" method="GET" class="search-form">
            <div class="keyword-search">
                <div class="search-input-wrapper">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" 
                           name="q" 
                           class="search-input" 
                           placeholder="åº—èˆ—åã€ã‚¨ãƒªã‚¢ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢..."
                           autocomplete="off">
                </div>
                <button type="submit" class="btn btn-primary btn-lg">æ¤œç´¢</button>
            </div>
        </form>
        
        <!-- Condition Search -->
        <div class="condition-search">
            <div class="condition-header" onclick="toggleConditions()">
                <span>ğŸ¯ æ¡ä»¶ã‚’æŒ‡å®šã—ã¦æ¢ã™</span>
                <span class="condition-toggle" id="condition-toggle">â–¼</span>
            </div>
            <form action="{{ url_for('public.search') }}" method="GET" class="condition-form" id="condition-form">
                <div class="condition-grid">
                    <div class="condition-item">
                        <label>ã‚¨ãƒªã‚¢</label>
                        <select name="area" class="form-control">
                            <option value="">ã™ã¹ã¦</option>
                            {% for area in areas %}
                            <option value="{{ area }}">{{ area }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="condition-item">
                        <label>æ¥­æ…‹</label>
                        <select name="category" class="form-control">
                            <option value="">ã™ã¹ã¦</option>
                            {% for cat in categories %}
                            <option value="{{ cat }}">{{ category_labels[cat] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="condition-item">
                        <label>æ–™é‡‘å¸¯</label>
                        <select name="price" class="form-control">
                            <option value="">ã™ã¹ã¦</option>
                            {% for price_range in price_ranges %}
                            <option value="{{ loop.index0 }}">{{ price_range[2] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="condition-item">
                        <label>ç©ºå¸­çŠ¶æ³</label>
                        <select name="vacancy" class="form-control">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="empty">ç©ºå¸­ã‚ã‚Š</option>
                            <option value="busy">æ··é›‘</option>
                        </select>
                    </div>
                </div>
                
                <div class="condition-options">
                    <label class="form-check">
                        <input type="checkbox" name="has_job" value="1" class="form-check-input">
                        <span>æ±‚äººå‹Ÿé›†ä¸­ã®ã¿</span>
                    </label>
                </div>
                
                <button type="submit" class="btn btn-gold btn-block">âœ¨ ã“ã®æ¡ä»¶ã§æ¤œç´¢</button>
            </form>
        </div>
    </div>
    
    <!-- Announcements -->
    {% if announcements %}
    <div class="announcements-section mb-4">
        <div class="announcements-header">
            <span class="announcements-icon">ğŸ“¢</span>
            <span class="announcements-title">ãŠçŸ¥ã‚‰ã›</span>
        </div>
        <div class="announcements-list">
            {% for announcement in announcements %}
            <div class="announcement-item">
                <span class="announcement-date">{{ announcement.created_at.strftime('%m/%d') }}</span>
                <span class="announcement-text">{{ announcement.title }}</span>
                {% if announcement.link_url %}
                <a href="{{ announcement.link_url }}" class="announcement-link">
                    {{ announcement.link_text or 'è©³ç´°' }} â†’
                </a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Quick Area Links -->
    <div class="quick-links mb-4">
        <h3 class="section-title">ğŸ“ ã‚¨ãƒªã‚¢ã‹ã‚‰æ¢ã™</h3>
        <div class="area-buttons">
            {% for area in areas %}
            <a href="{{ url_for('public.search', area=area) }}" class="area-btn">
                {{ area }}
            </a>
            {% endfor %}
        </div>
    </div>
    
    <!-- Featured Shops -->
    {% if featured_shops %}
    <div class="featured-section mb-4">
        <h3 class="section-title">
            â­ ãŠã™ã™ã‚åº—èˆ—
        </h3>
        <div class="shop-grid">
            {% for shop in featured_shops %}
            {% include "public/_shop_card.html" %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Recent Shops -->
    {% if recent_shops %}
    <div class="recent-section mb-4">
        <h3 class="section-title">
            ğŸ†• æ–°ç€åº—èˆ—
        </h3>
        <div class="shop-grid">
            {% for shop in recent_shops %}
            {% include "public/_shop_card.html" %}
            {% endfor %}
        </div>
        
        <div class="text-center mt-3">
            <a href="{{ url_for('public.search') }}" class="btn btn-gold">
                âœ¨ ã™ã¹ã¦ã®åº—èˆ—ã‚’è¦‹ã‚‹ â†’
            </a>
        </div>
    </div>
    {% endif %}
</div>

{% block extra_js %}
<script>
// Condition search toggle
function toggleConditions() {
    const form = document.getElementById('condition-form');
    const toggle = document.getElementById('condition-toggle');
    
    if (form.style.display === 'none' || form.style.display === '') {
        form.style.display = 'block';
        toggle.textContent = 'â–²';
    } else {
        form.style.display = 'none';
        toggle.textContent = 'â–¼';
    }
}

// Banner carousel
const bannerItems = document.querySelectorAll('.banner-item');
const dots = document.querySelectorAll('.banner-dots .dot');
let currentBanner = 0;

if (bannerItems.length > 1) {
    setInterval(() => {
        bannerItems[currentBanner].classList.remove('active');
        if (dots[currentBanner]) dots[currentBanner].classList.remove('active');
        
        currentBanner = (currentBanner + 1) % bannerItems.length;
        
        bannerItems[currentBanner].classList.add('active');
        if (dots[currentBanner]) dots[currentBanner].classList.add('active');
    }, 5000);
    
    dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
            bannerItems[currentBanner].classList.remove('active');
            dots[currentBanner].classList.remove('active');
            
            currentBanner = index;
            
            bannerItems[currentBanner].classList.add('active');
            dots[currentBanner].classList.add('active');
        });
    });
}
</script>
{% endblock %}
{% endblock %}
