{% extends "base.html" %}

{% block title %}{{ cast.name_display }} | {{ shop.name }} ({{ shop.area }}) - Night-Walk{% endblock %}

{% block meta_description %}{{ cast.name_display }}ã¯{{ shop.area }}ã®{{ shop.name }}ã«åœ¨ç±ã™ã‚‹ã‚­ãƒ£ã‚¹ãƒˆã§ã™ã€‚{% if cast.comment %}{{ cast.comment | truncate(80) }}{% endif %}{% endblock %}

{% block og_image %}{% if cast.image_url %}{{ cast.image_url }}{% else %}{{ url_for('static', filename='images/ogp-default.png', _external=True) }}{% endif %}{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "{{ cast.name_display }}",
  "jobTitle": "ã‚­ãƒ£ã‚¹ãƒˆ",
  "worksFor": {
    "@type": "LocalBusiness",
    "name": "{{ shop.name }}",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "{{ shop.area }}",
      "addressRegion": "å²¡å±±çœŒ"
    }
  }
  {% if cast.image_url %},
  "image": "{{ cast.image_url }}"
  {% endif %}
}
</script>
{% endblock %}

{% block content %}
<div class="container" style="max-width: 600px; padding: var(--space-lg);">
    
    <p class="mb-3">
        <a href="{{ url_for('public.shop_detail', shop_id=shop.id) }}">â† {{ shop.name }}</a>
    </p>
    
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="card mb-4" style="text-align: center; {% if cast.is_top1 %}background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,165,0,0.15));{% endif %}">
        
        <!-- ãƒãƒƒã‚¸è¡¨ç¤º -->
        {% if cast.best_badge %}
        <div style="margin-bottom: var(--space-md);">
            {% if cast.best_badge.badge_type == 'area_top1' %}
            <span class="badge" style="background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; font-size: 1rem; padding: var(--space-sm) var(--space-md);">
                ğŸ‘‘ {{ cast.best_badge.area_name }} TOP1
            </span>
            {% elif cast.best_badge.badge_type == 'area_top3' %}
            <span class="badge" style="background: linear-gradient(135deg, #C0C0C0, #A0A0A0); color: #000; padding: var(--space-sm) var(--space-md);">
                ğŸ¥ˆ {{ cast.best_badge.area_name }} TOP3
            </span>
            {% elif cast.best_badge.badge_type == 'area_top10' %}
            <span class="badge" style="background: linear-gradient(135deg, #CD7F32, #8B4513); color: #fff; padding: var(--space-sm) var(--space-md);">
                ğŸ… {{ cast.best_badge.area_name }} TOP10
            </span>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- ç”»åƒ -->
        {% if cast.image_url %}
        <img src="{{ cast.image_url }}" 
             alt="{{ cast.name_display }}"
             style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: var(--space-md);
                    {% if cast.is_top1 %}border: 4px solid gold; box-shadow: 0 0 20px rgba(255,215,0,0.5);{% else %}border: 3px solid var(--color-border);{% endif %}">
        {% endif %}
        
        <h1 style="margin: 0 0 var(--space-sm);">{{ cast.name_display }}</h1>
        
        <p class="text-muted mb-0">
            <a href="{{ url_for('public.shop_detail', shop_id=shop.id) }}">{{ shop.name }}</a>
            ãƒ» {{ shop.area }}
        </p>
        
        <!-- å‡ºå‹¤çŠ¶æ³ -->
        {% if cast.work_status != 'off' %}
        <div style="margin-top: var(--space-md); padding: var(--space-sm) var(--space-md); border-radius: 8px; 
                    background: {% if cast.work_status == 'working' %}rgba(16, 185, 129, 0.15){% else %}rgba(245, 158, 11, 0.15){% endif %};">
            <span class="badge badge-{{ cast.work_status_color }}" style="font-size: 0.9rem;">
                {% if cast.work_status == 'working' %}ğŸŸ¢{% else %}ğŸŸ¡{% endif %} {{ cast.work_status_label }}
            </span>
            {% if cast.work_time_display %}
            <span class="text-muted" style="margin-left: 8px;">{{ cast.work_time_display }}</span>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- æœ¬æ—¥ã®ã‚³ãƒ¡ãƒ³ãƒˆ -->
        {% if cast.comment %}
        <div style="margin-top: var(--space-sm); padding: var(--space-sm); background: var(--color-bg-secondary); border-radius: 8px; font-size: 0.9rem;">
            ğŸ’¬ {{ cast.comment }}
        </div>
        {% endif %}
        
        <!-- ç¾åœ¨ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
        {% if cast.current_rank %}
        <p style="margin-top: var(--space-sm);">
            <span class="badge badge-primary">ç¾åœ¨ {{ cast.area }}{{ cast.current_rank }}ä½</span>
        </p>
        {% endif %}
    </div>
    
    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« -->
    {% if cast.profile %}
    <div class="card mb-4">
        <h3 class="mb-3">ğŸ“ è‡ªå·±ç´¹ä»‹</h3>
        <p style="margin: 0; white-space: pre-wrap;">{{ cast.profile }}</p>
    </div>
    {% endif %}
    
    <!-- SNS -->
    {% if cast.twitter_url or cast.instagram_url %}
    <div class="card mb-4">
        <h3 class="mb-3">ğŸ“± SNS</h3>
        <div class="d-flex gap-2">
            {% if cast.twitter_url %}
            <a href="{{ cast.twitter_url }}" target="_blank" class="btn btn-secondary" style="flex: 1;">
                ğ• Twitter
            </a>
            {% endif %}
            {% if cast.instagram_url %}
            <a href="{{ cast.instagram_url }}" target="_blank" class="btn btn-secondary" style="flex: 1;">
                ğŸ“· Instagram
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- ç´¯è¨ˆæƒ…å ± -->
    <div class="card mb-4">
        <h3 class="mb-3">ğŸ’ å¿œæ´çŠ¶æ³</h3>
        <div class="d-flex gap-3">
            <div style="flex: 1; text-align: center; padding: var(--space-md); background: var(--color-bg-elevated); border-radius: var(--radius);">
                <div class="text-muted" style="font-size: 0.85rem;">å—ã‘å–ã£ãŸã‚®ãƒ•ãƒˆ</div>
                <div style="font-size: 1.5rem; font-weight: bold;">{{ '{:,}'.format(cast.total_gifts_received) }}</div>
            </div>
            <div style="flex: 1; text-align: center; padding: var(--space-md); background: var(--color-bg-elevated); border-radius: var(--radius);">
                <div class="text-muted" style="font-size: 0.85rem;">ç´¯è¨ˆãƒã‚¤ãƒ³ãƒˆ</div>
                <div style="font-size: 1.5rem; font-weight: bold;">{{ '{:,}'.format(cast.total_points_received) }}</div>
            </div>
        </div>
    </div>
    
    <!-- ã‚®ãƒ•ãƒˆã‚’é€ã‚‹ -->
    {% if cast.is_accepting_gifts and gifts %}
    <div class="card mb-4">
        <h3 class="mb-3">ğŸ ã‚®ãƒ•ãƒˆã‚’é€ã‚‹</h3>
        
        {% if current_user.is_authenticated and current_user.is_customer %}
        <p class="text-muted mb-3">ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜: {{ '{:,}'.format(current_user.point_balance) }}pt</p>
        
        <div class="d-flex gap-2" style="flex-wrap: wrap;">
            {% for gift in gifts[:6] %}
            <a href="{{ url_for('customer.send_gift', cast_id=cast.id, gift_id=gift.id) }}" 
               class="card" 
               style="flex: 1; min-width: 100px; text-align: center; text-decoration: none; padding: var(--space-md);">
                {% if gift.image_url %}
                <img src="{{ gift.image_url }}" style="width: 40px; height: 40px; margin: 0 auto var(--space-sm);">
                {% endif %}
                <div style="font-size: 0.85rem;">{{ gift.name }}</div>
                <div style="font-weight: bold; color: var(--color-primary);">{{ gift.points }}pt</div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted text-center">
            ã‚®ãƒ•ãƒˆã‚’é€ã‚‹ã«ã¯<a href="{{ url_for('customer.login') }}">ãƒ­ã‚°ã‚¤ãƒ³</a>ã—ã¦ãã ã•ã„
        </p>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- ãƒãƒƒã‚¸å±¥æ­´ -->
    {% set badge_history = cast.badges.order_by(None).limit(6).all() %}
    {% if badge_history %}
    <div class="card mb-4">
        <h3 class="mb-3">ğŸ† ç²å¾—ãƒãƒƒã‚¸</h3>
        <div class="d-flex gap-2" style="flex-wrap: wrap;">
            {% for badge in badge_history %}
            <div style="text-align: center; padding: var(--space-sm); background: var(--color-bg-elevated); border-radius: var(--radius); min-width: 80px;">
                {% if badge.badge_type == 'area_top1' %}
                <div style="font-size: 1.5rem;">ğŸ¥‡</div>
                {% elif badge.badge_type == 'area_top3' %}
                <div style="font-size: 1.5rem;">ğŸ¥ˆ</div>
                {% else %}
                <div style="font-size: 1.5rem;">ğŸ¥‰</div>
                {% endif %}
                <div style="font-size: 0.75rem;">{{ badge.area_name }}</div>
                <div style="font-size: 0.7rem; color: var(--color-text-secondary);">{{ badge.year }}/{{ badge.month }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- åº—èˆ—æƒ…å ± -->
    <div class="card">
        <h3 class="mb-3">ğŸ  åº—èˆ—æƒ…å ±</h3>
        <p style="margin: 0;"><strong>{{ shop.name }}</strong></p>
        <p class="text-muted mb-2">{{ shop.area }}</p>
        
        {% if shop.business_hours %}
        <p style="margin: 0; font-size: 0.9rem;">ğŸ• {{ shop.business_hours }}</p>
        {% endif %}
        
        <div style="margin-top: var(--space-md);">
            <a href="{{ url_for('public.shop_detail', shop_id=shop.id) }}" class="btn btn-secondary" style="width: 100%;">
                åº—èˆ—è©³ç´°ã‚’è¦‹ã‚‹
            </a>
        </div>
    </div>
    
</div>
{% endblock %}
