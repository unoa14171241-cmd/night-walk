{% extends "base.html" %}

{% block title %}急上昇{{ '店舗' if target_type == 'shop' else 'キャスト' }} - Night-Walk{% endblock %}

{% block meta_description %}{% if selected_area %}{{ selected_area }}エリアで{% endif %}直近1時間で注目度が急上昇中の{{ '店舗' if target_type == 'shop' else 'キャスト' }}をチェック！{% endblock %}

{% block content %}
<div class="container">
 <div class="page-header">
 <h1> 急上昇{{ '店舗' if target_type == 'shop' else 'キャスト' }}</h1>
 <p class="text-muted">直近1時間で注目度が急上昇中！</p>
 </div>
 
 <!-- フィルタ -->
 <div class="card mb-4">
 <div class="d-flex gap-3 flex-wrap">
 <div class="btn-group">
 <a href="{{ url_for('public.trending', type='shop', area=selected_area) }}" 
 class="btn {{ 'btn-primary' if target_type == 'shop' else 'btn-secondary' }}">
 店舗
 </a>
 <a href="{{ url_for('public.trending', type='cast', area=selected_area) }}" 
 class="btn {{ 'btn-primary' if target_type == 'cast' else 'btn-secondary' }}">
 キャスト
 </a>
 </div>
 
 <select onchange="location.href=this.value" class="form-control" style="width: auto;">
 <option value="{{ url_for('public.trending', type=target_type) }}" {{ 'selected' if not selected_area }}>全エリア</option>
 {% for area in areas %}
 <option value="{{ url_for('public.trending', type=target_type, area=area) }}" {{ 'selected' if selected_area == area }}>{{ area }}</option>
 {% endfor %}
 </select>
 </div>
 </div>
 
 <!-- ランキング -->
 {% if trending_list %}
 <div class="trending-list">
 {% for item in trending_list %}
 <div class="trending-card rank-{{ item.rank }}">
 <div class="trending-rank">
 {% if item.rank == 1 %}
 <span class="rank-icon gold"></span>
 {% elif item.rank == 2 %}
 <span class="rank-icon silver"></span>
 {% elif item.rank == 3 %}
 <span class="rank-icon bronze"></span>
 {% else %}
 <span class="rank-number">#{{ item.rank }}</span>
 {% endif %}
 </div>
 
 <div class="trending-image">
 {% if target_type == 'shop' and item.shop %}
 {% if item.shop.main_image_url %}
 <img src="{{ item.shop.main_image_url }}" alt="{{ item.shop.name }}">
 {% else %}
 <div class="no-image"></div>
 {% endif %}
 {% elif target_type == 'cast' and item.cast %}
 <img src="{{ item.cast.image_url }}" alt="{{ item.cast.name_display }}">
 {% endif %}
 </div>
 
 <div class="trending-info">
 {% if target_type == 'shop' and item.shop %}
 <a href="{{ url_for('public.shop_detail', shop_id=item.shop_id) }}" class="trending-name">
 {{ item.shop.name }}
 </a>
 <div class="trending-sub">{{ item.shop.area }} / {{ item.shop.category_label }}</div>
 {% elif target_type == 'cast' and item.cast %}
 <a href="{{ url_for('public.cast_detail', cast_id=item.cast_id) }}" class="trending-name">
 {{ item.cast.name_display }}
 </a>
 <div class="trending-sub">{{ item.cast.shop.name if item.cast.shop else '' }}</div>
 {% endif %}
 </div>
 
 <div class="trending-stats">
 <div class="growth-rate {{ 'positive' if item.growth_rate > 0 else '' }}">
 {% if item.growth_rate > 0 %}↑{% elif item.growth_rate < 0 %}↓{% endif %}
 {{ (item.growth_rate * 100)|int }}%
 </div>
 <div class="pv-count">
 <small>{{ item.current_pv }} PV</small>
 </div>
 </div>
 </div>
 {% endfor %}
 </div>
 {% else %}
 <div class="card">
 <p class="text-center text-muted">
 まだ急上昇データがありません。<br>
 しばらくお待ちください。
 </p>
 </div>
 {% endif %}
</div>

<style>
.page-header {
 margin-bottom: 2rem;
}
.page-header h1 {
 margin-bottom: 0.5rem;
}

.btn-group {
 display: inline-flex;
 border-radius: var(--radius);
 overflow: hidden;
}
.btn-group .btn {
 border-radius: 0;
}
.btn-group .btn:first-child {
 border-radius: var(--radius) 0 0 var(--radius);
}
.btn-group .btn:last-child {
 border-radius: 0 var(--radius) var(--radius) 0;
}

.trending-list {
 display: flex;
 flex-direction: column;
 gap: 1rem;
}

.trending-card {
 display: flex;
 align-items: center;
 gap: 1rem;
 padding: 1rem;
 background: var(--color-bg-card);
 border-radius: var(--radius);
 transition: transform 0.2s, box-shadow 0.2s;
}
.trending-card:hover {
 transform: translateY(-2px);
 box-shadow: var(--shadow-lg);
}
.trending-card.rank-1 {
 background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,215,0,0.05));
 border: 2px solid #ffd700;
}
.trending-card.rank-2 {
 background: linear-gradient(135deg, rgba(192,192,192,0.15), rgba(192,192,192,0.05));
 border: 1px solid #c0c0c0;
}
.trending-card.rank-3 {
 background: linear-gradient(135deg, rgba(205,127,50,0.15), rgba(205,127,50,0.05));
 border: 1px solid #cd7f32;
}

.trending-rank {
 min-width: 50px;
 text-align: center;
}
.rank-icon {
 font-size: 2rem;
}
.rank-number {
 font-size: 1.5rem;
 font-weight: 700;
 color: var(--color-text-muted);
}

.trending-image {
 width: 80px;
 height: 80px;
 border-radius: var(--radius);
 overflow: hidden;
 flex-shrink: 0;
}
.trending-image img {
 width: 100%;
 height: 100%;
 object-fit: cover;
}
.trending-image .no-image {
 width: 100%;
 height: 100%;
 display: flex;
 align-items: center;
 justify-content: center;
 background: var(--color-bg-elevated);
 font-size: 2rem;
}

.trending-info {
 flex: 1;
 min-width: 0;
}
.trending-name {
 font-size: 1.125rem;
 font-weight: 600;
 color: var(--color-text);
 text-decoration: none;
 display: block;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
}
.trending-name:hover {
 color: var(--color-primary);
}
.trending-sub {
 font-size: 0.875rem;
 color: var(--color-text-muted);
}

.trending-stats {
 text-align: right;
 min-width: 80px;
}
.growth-rate {
 font-size: 1.25rem;
 font-weight: 700;
 color: var(--color-text-muted);
}
.growth-rate.positive {
 color: var(--color-success);
}
.pv-count {
 color: var(--color-text-muted);
}

@media (max-width: 640px) {
 .trending-card {
 flex-wrap: wrap;
 }
 .trending-image {
 width: 60px;
 height: 60px;
 }
 .trending-info {
 flex: 1 1 calc(100% - 150px);
 }
 .trending-stats {
 flex: 1 1 100%;
 text-align: left;
 margin-top: 0.5rem;
 padding-top: 0.5rem;
 border-top: 1px solid var(--color-border);
 }
}
</style>
{% endblock %}
