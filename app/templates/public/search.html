{% extends "customer/base.html" %}

{% block title %}
{% if keyword %}„Äå{{ keyword }}„Äç„ÅÆÊ§úÁ¥¢ÁµêÊûú{% else %}Â∫óËàóÊ§úÁ¥¢{% endif %} - Night-Walk
{% endblock %}

{% block content %}
<div class="container">
    <div class="search-results-layout">
        <!-- Main Content -->
        <div class="search-main">
            <!-- Search Form -->
            <div class="search-form-compact mb-4">
                <form action="{{ url_for('public.search') }}" method="GET">
                    <div class="keyword-search">
                        <div class="search-input-wrapper">
                            <span class="search-icon"></span>
                            <input type="text" 
                                   name="q" 
                                   class="search-input" 
                                   placeholder="Â∫óËàóÂêç„ÄÅ„Ç®„É™„Ç¢„ÄÅ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÊ§úÁ¥¢..."
                                   value="{{ keyword }}"
                                   autocomplete="off">
                        </div>
                        <button type="submit" class="btn btn-primary">Ê§úÁ¥¢</button>
                    </div>
                    
                    <!-- Condition Filters (Expanded) -->
                    <div class="filter-bar">
                        <select name="area" class="filter-select" onchange="this.form.submit()">
                            <option value="">„Ç®„É™„Ç¢: „Åô„Åπ„Å¶</option>
                            {% for area in areas %}
                            <option value="{{ area }}" {% if selected_area == area %}selected{% endif %}>
                                {{ area }}
                            </option>
                            {% endfor %}
                        </select>
                        
                        <select name="category" class="filter-select" onchange="this.form.submit()">
                            <option value="">Ê•≠ÊÖã: „Åô„Åπ„Å¶</option>
                            {% for cat in categories %}
                            <option value="{{ cat }}" {% if selected_category == cat %}selected{% endif %}>
                                {{ category_labels[cat] }}
                            </option>
                            {% endfor %}
                        </select>
                        
                        <select name="price" class="filter-select" onchange="this.form.submit()">
                            <option value="">ÊñôÈáë: „Åô„Åπ„Å¶</option>
                            {% for idx in range(price_ranges | length) %}
                            <option value="{{ idx }}" {% if selected_price == idx | string %}selected{% endif %}>
                                {{ price_ranges[idx][2] }}
                            </option>
                            {% endfor %}
                        </select>
                        
                        <select name="vacancy" class="filter-select" onchange="this.form.submit()">
                            <option value="">Á©∫Â∏≠: „Åô„Åπ„Å¶</option>
                            {% for status in vacancy_statuses %}
                            <option value="{{ status }}" {% if selected_vacancy == status %}selected{% endif %}>
                                {{ vacancy_labels[status] }}Â∏≠
                            </option>
                            {% endfor %}
                        </select>
                        
                        <label class="filter-checkbox">
                            <input type="checkbox" 
                                   name="has_job" 
                                   value="1" 
                                   {% if has_job %}checked{% endif %}
                                   onchange="this.form.submit()">
                            <span>Ê±Ç‰∫∫„ÅÇ„Çä</span>
                        </label>
                    </div>
                </form>
            </div>
            
            <!-- Results Header -->
            <div class="results-header mb-3">
                <h1 class="results-title">
                    {% if keyword %}
                    „Äå{{ keyword }}„Äç„ÅÆÊ§úÁ¥¢ÁµêÊûú
                    {% else %}
                    Â∫óËàó‰∏ÄË¶ß
                    {% endif %}
                </h1>
                <span class="results-count">{{ shops | length }}‰ª∂</span>
            </div>
            
            <!-- Active Filters -->
            {% if selected_area or selected_category or selected_price or selected_vacancy or has_job %}
            <div class="active-filters mb-3">
                <span class="active-filters-label">Áµû„ÇäËæº„Åø:</span>
                {% if selected_area %}
                <span class="filter-tag">
                    {{ selected_area }}
                    <a href="{{ url_for('public.search', q=keyword, category=selected_category, price=selected_price, vacancy=selected_vacancy, has_job='1' if has_job else '') }}">&times;</a>
                </span>
                {% endif %}
                {% if selected_category %}
                <span class="filter-tag">
                    {{ category_labels[selected_category] }}
                    <a href="{{ url_for('public.search', q=keyword, area=selected_area, price=selected_price, vacancy=selected_vacancy, has_job='1' if has_job else '') }}">&times;</a>
                </span>
                {% endif %}
                {% if selected_price %}
                <span class="filter-tag">
                    {{ price_ranges[selected_price | int][2] }}
                    <a href="{{ url_for('public.search', q=keyword, area=selected_area, category=selected_category, vacancy=selected_vacancy, has_job='1' if has_job else '') }}">&times;</a>
                </span>
                {% endif %}
                {% if selected_vacancy %}
                <span class="filter-tag">
                    {{ vacancy_labels[selected_vacancy] }}Â∏≠
                    <a href="{{ url_for('public.search', q=keyword, area=selected_area, category=selected_category, price=selected_price, has_job='1' if has_job else '') }}">&times;</a>
                </span>
                {% endif %}
                {% if has_job %}
                <span class="filter-tag">
                    Ê±Ç‰∫∫„ÅÇ„Çä
                    <a href="{{ url_for('public.search', q=keyword, area=selected_area, category=selected_category, price=selected_price, vacancy=selected_vacancy) }}">&times;</a>
                </span>
                {% endif %}
                <a href="{{ url_for('public.search', q=keyword) }}" class="clear-filters">„Åô„Åπ„Å¶„ÇØ„É™„Ç¢</a>
            </div>
            {% endif %}
            
            <!-- Shop Grid -->
            {% if shops %}
            <div class="shop-grid">
                {% for shop in shops %}
                {% include "public/_shop_card.html" %}
                {% endfor %}
            </div>
            {% else %}
            <div class="no-results">
                <div class="no-results-icon"></div>
                <h3>Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                <p class="text-muted">Êù°‰ª∂„ÇíÂ§âÊõ¥„Åó„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ</p>
                <a href="{{ url_for('public.index') }}" class="btn btn-primary mt-3">
                    „Éà„ÉÉ„Éó„Å´Êàª„Çã
                </a>
            </div>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <aside class="search-sidebar">
            {% if sidebar_ads %}
            <div class="sidebar-ads">
                {% for ad in sidebar_ads %}
                <a href="{{ url_for('public.ad_click', ad_id=ad.id) }}" 
                   class="sidebar-ad"
                   target="_blank"
                   rel="noopener">
                    {% if ad.display_image_url %}
                    <img src="{{ ad.display_image_url }}" alt="{{ ad.title }}">
                    {% else %}
                    <div class="sidebar-ad-placeholder">{{ ad.title }}</div>
                    {% endif %}
                </a>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Quick Links -->
            <div class="sidebar-section">
                <h4>„Ç®„É™„Ç¢„Åã„ÇâÊé¢„Åô</h4>
                <div class="sidebar-links">
                    {% for area in areas %}
                    <a href="{{ url_for('public.search', area=area) }}" 
                       class="sidebar-link {% if selected_area == area %}active{% endif %}">
                        üìç {{ area }}
                    </a>
                    {% endfor %}
                </div>
            </div>
            
            <div class="sidebar-section">
                <h4>Ê•≠ÊÖã„Åã„ÇâÊé¢„Åô</h4>
                <div class="sidebar-links">
                    {% for cat in categories %}
                    <a href="{{ url_for('public.search', category=cat) }}" 
                       class="sidebar-link {% if selected_category == cat %}active{% endif %}">
                        {{ category_labels[cat] }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </aside>
    </div>
</div>
{% endblock %}
