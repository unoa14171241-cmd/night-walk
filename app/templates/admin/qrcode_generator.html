{% extends "base.html" %}

{% block title %}QRã‚³ãƒ¼ãƒ‰ç™ºè¡Œ - Night-Walk{% endblock %}

{% block content %}
<div class="admin-layout">
    {% include "admin/_sidebar.html" %}
    
    <div class="admin-content">
        <h1 class="mb-4">ğŸ“± QRã‚³ãƒ¼ãƒ‰ç™ºè¡Œ</h1>
        
        <div class="grid-qr">
            <!-- è¨­å®šãƒ‘ãƒãƒ« -->
            <div class="card">
                <h3 class="mb-3">URLè¨­å®š</h3>
                
                <form method="GET" action="{{ url_for('admin.qrcode_generator') }}">
                    <div class="form-group">
                        <label class="form-label" for="url">å¯¾è±¡URL</label>
                        <input type="url" 
                               id="url" 
                               name="url" 
                               class="form-control" 
                               value="{{ target_url }}"
                               placeholder="https://..."
                               required>
                        <small class="text-muted">QRã‚³ãƒ¼ãƒ‰ã«åŸ‹ã‚è¾¼ã‚€URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ãƒ—ãƒªã‚»ãƒƒãƒˆ</label>
                        <div class="preset-buttons">
                            <button type="button" class="btn btn-sm btn-secondary preset-btn" 
                                    data-url="{{ default_url }}">
                                åº—èˆ—æ²è¼‰ç”³ã—è¾¼ã¿
                            </button>
                            <button type="button" class="btn btn-sm btn-secondary preset-btn" 
                                    data-url="{{ request.host_url.rstrip('/') }}">
                                ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
                            </button>
                            <button type="button" class="btn btn-sm btn-secondary preset-btn" 
                                    data-url="{{ request.host_url.rstrip('/') }}/customer/register">
                                ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
                    </button>
                </form>
            </div>
            
            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‘ãƒãƒ« -->
            <div class="card">
                <h3 class="mb-3">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                
                {% if qr_base64 %}
                <div class="qr-preview">
                    <img src="data:image/png;base64,{{ qr_base64 }}" alt="QRã‚³ãƒ¼ãƒ‰" class="qr-image">
                </div>
                
                <div class="url-display">
                    <code>{{ target_url }}</code>
                </div>
                
                <hr style="border-color: var(--color-border); margin: var(--space-lg) 0;">
                
                <h4 class="mb-3">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h4>
                
                <div class="download-options">
                    <div class="download-group">
                        <h5>PNGå½¢å¼</h5>
                        <p class="text-muted small">Webãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«ç”¨é€”å‘ã‘</p>
                        <a href="{{ url_for('admin.qrcode_download', format='png', url=target_url) }}" 
                           class="btn btn-secondary btn-sm">
                            ğŸ“¥ æ¨™æº–è§£åƒåº¦
                        </a>
                        <a href="{{ url_for('admin.qrcode_download', format='png', url=target_url, high_res='true') }}" 
                           class="btn btn-primary btn-sm">
                            ğŸ“¥ é«˜è§£åƒåº¦ï¼ˆååˆºå°åˆ·ç”¨ï¼‰
                        </a>
                    </div>
                    
                    <div class="download-group">
                        <h5>SVGå½¢å¼</h5>
                        <p class="text-muted small">ãƒ™ã‚¯ã‚¿ãƒ¼å½¢å¼ãƒ»ã©ã‚“ãªã‚µã‚¤ã‚ºã§ã‚‚ç¶ºéº—</p>
                        <a href="{{ url_for('admin.qrcode_download', format='svg', url=target_url) }}" 
                           class="btn btn-secondary btn-sm">
                            ğŸ“¥ SVGãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        </a>
                    </div>
                </div>
                {% else %}
                <div class="qr-placeholder">
                    <div class="placeholder-icon">ğŸ“±</div>
                    <p>URLã‚’å…¥åŠ›ã—ã¦QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ -->
        <div class="card mt-4">
            <h3 class="mb-3">ä½¿ã„æ–¹</h3>
            <div class="usage-guide">
                <div class="guide-item">
                    <div class="guide-number">1</div>
                    <div class="guide-content">
                        <strong>URLã‚’å…¥åŠ›</strong>
                        <p>QRã‚³ãƒ¼ãƒ‰ã«åŸ‹ã‚è¾¼ã¿ãŸã„URLã‚’å…¥åŠ›ã€ã¾ãŸã¯ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰é¸æŠã—ã¾ã™ã€‚</p>
                    </div>
                </div>
                <div class="guide-item">
                    <div class="guide-number">2</div>
                    <div class="guide-content">
                        <strong>QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ</strong>
                        <p>ã€ŒQRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
                    </div>
                </div>
                <div class="guide-item">
                    <div class="guide-number">3</div>
                    <div class="guide-content">
                        <strong>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</strong>
                        <p>ç”¨é€”ã«åˆã‚ã›ã¦PNGï¼ˆé«˜è§£åƒåº¦ï¼‰ã¾ãŸã¯SVGå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p>
                    </div>
                </div>
            </div>
            
            <div class="format-info mt-4">
                <h4>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®é¸ã³æ–¹</h4>
                <table class="table" style="margin-top: var(--space-md);">
                    <tr>
                        <td><strong>PNGï¼ˆæ¨™æº–ï¼‰</strong></td>
                        <td>Webè¡¨ç¤ºã€ãƒ¡ãƒ¼ãƒ«æ·»ä»˜ã€SNSæŠ•ç¨¿ãªã©</td>
                    </tr>
                    <tr>
                        <td><strong>PNGï¼ˆé«˜è§£åƒåº¦ï¼‰</strong></td>
                        <td>ååˆºå°åˆ·ã€ãƒãƒ©ã‚·ã€ãƒã‚¹ã‚¿ãƒ¼ãªã©å°åˆ·ç‰©å‘ã‘</td>
                    </tr>
                    <tr>
                        <td><strong>SVG</strong></td>
                        <td>æ‹¡å¤§ç¸®å°ã—ã¦ã‚‚åŠ£åŒ–ã—ãªã„ã€‚ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã¸ã®å…¥ç¨¿ã«æœ€é©</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
.grid-qr {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-lg);
}

@media (max-width: 968px) {
    .grid-qr {
        grid-template-columns: 1fr;
    }
}

.preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-top: var(--space-sm);
}

.qr-preview {
    display: flex;
    justify-content: center;
    padding: var(--space-lg);
    background: white;
    border-radius: var(--radius);
    margin-bottom: var(--space-md);
}

.qr-image {
    max-width: 200px;
    height: auto;
}

.url-display {
    text-align: center;
    padding: var(--space-sm);
    background: var(--color-bg-elevated);
    border-radius: var(--radius);
    word-break: break-all;
}

.url-display code {
    font-size: 0.75rem;
    color: var(--color-primary);
}

.download-options {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
}

.download-group h5 {
    margin-bottom: var(--space-xs);
    font-size: 0.875rem;
}

.download-group .small {
    font-size: 0.75rem;
    margin-bottom: var(--space-sm);
}

.download-group .btn {
    margin-right: var(--space-sm);
    margin-bottom: var(--space-sm);
}

.qr-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-xl);
    background: var(--color-bg-elevated);
    border-radius: var(--radius);
    color: var(--color-text-muted);
    min-height: 250px;
}

.placeholder-icon {
    font-size: 3rem;
    margin-bottom: var(--space-md);
    opacity: 0.5;
}

.usage-guide {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
}

.guide-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-md);
}

.guide-number {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-primary);
    color: white;
    border-radius: 50%;
    font-weight: bold;
    flex-shrink: 0;
}

.guide-content p {
    margin: var(--space-xs) 0 0;
    color: var(--color-text-muted);
    font-size: 0.875rem;
}

.format-info h4 {
    font-size: 1rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    document.querySelectorAll('.preset-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var url = this.getAttribute('data-url');
            document.getElementById('url').value = url;
        });
    });
});
</script>
{% endblock %}
