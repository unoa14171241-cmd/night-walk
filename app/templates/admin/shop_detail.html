{% extends "base.html" %}

{% block title %}{{ shop.name }} - åº—èˆ—è©³ç´° - Night-Walk{% endblock %}

{% block content %}
<div class="admin-layout">
    {% include "admin/_sidebar.html" %}
    
    <div class="admin-content">
        <p class="mb-3">
            <a href="{{ url_for('admin.shops') }}">â† åº—èˆ—ä¸€è¦§ã«æˆ»ã‚‹</a>
        </p>
        
        <div class="d-flex justify-between align-center mb-4">
            <div>
                <h1 class="mb-1">{{ shop.name }}</h1>
                <p class="text-muted mb-0">ğŸ“ {{ shop.area }}</p>
            </div>
            <div class="d-flex gap-2">
                <a href="{{ url_for('shop_admin.select_shop', shop_id=shop.id) }}" class="btn btn-primary">
                    åº—èˆ—ã¨ã—ã¦ç®¡ç†
                </a>
                <form method="POST" action="{{ url_for('admin.toggle_shop', shop_id=shop.id) }}" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn {% if shop.is_active %}btn-danger{% else %}btn-secondary{% endif %}">
                        {% if shop.is_active %}ç„¡åŠ¹åŒ–{% else %}æœ‰åŠ¹åŒ–{% endif %}
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Shop Info -->
        <div class="card mb-4">
            <h3 class="mb-3">åº—èˆ—æƒ…å ±</h3>
            <table class="table" style="margin: 0;">
                <tr>
                    <th style="width: 150px;">çŠ¶æ…‹</th>
                    <td>
                        {% if shop.is_active %}
                            {% if shop.is_published %}
                            <span class="badge badge-success">å…¬é–‹ä¸­</span>
                            {% else %}
                            <span class="badge badge-warning">éå…¬é–‹</span>
                            {% endif %}
                        {% else %}
                        <span class="badge badge-danger">ç„¡åŠ¹</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>é›»è©±ç•ªå·</th>
                    <td>{{ shop.phone or 'âˆ’' }}</td>
                </tr>
                <tr>
                    <th>ä½æ‰€</th>
                    <td>{{ shop.address or 'âˆ’' }}</td>
                </tr>
                <tr>
                    <th>å–¶æ¥­æ™‚é–“</th>
                    <td>{{ shop.business_hours or 'âˆ’' }}</td>
                </tr>
                <tr>
                    <th>æ–™é‡‘ç›®å®‰</th>
                    <td>{{ shop.price_range or 'âˆ’' }}</td>
                </tr>
                <tr>
                    <th>ç™»éŒ²æ—¥</th>
                    <td>{{ shop.created_at.strftime('%Y/%m/%d %H:%M') }}</td>
                </tr>
            </table>
        </div>
        
        <!-- Members -->
        <div class="card mb-4">
            <h3 class="mb-3">ã‚¹ã‚¿ãƒƒãƒ•</h3>
            
            {% if members %}
            <table class="table mb-3">
                <thead>
                    <tr>
                        <th>åå‰</th>
                        <th>ãƒ¡ãƒ¼ãƒ«</th>
                        <th>æ¨©é™</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr>
                        <td>{{ member.user.name }}</td>
                        <td>{{ member.user.email }}</td>
                        <td>
                            {% if member.role == 'owner' %}
                            <span class="badge badge-warning">ã‚ªãƒ¼ãƒŠãƒ¼</span>
                            {% else %}
                            <span class="badge" style="background: var(--color-bg-elevated);">ã‚¹ã‚¿ãƒƒãƒ•</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted mb-3">ã¾ã ã‚¹ã‚¿ãƒƒãƒ•ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            {% endif %}
            
            <!-- Add Member Form -->
            <form method="POST" action="{{ url_for('admin.add_shop_member', shop_id=shop.id) }}" class="d-flex gap-2" style="flex-wrap: wrap;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="email" name="email" class="form-control" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required style="flex: 1; min-width: 200px;">
                <select name="role" class="form-control" style="width: auto;">
                    <option value="staff">ã‚¹ã‚¿ãƒƒãƒ•</option>
                    <option value="owner">ã‚ªãƒ¼ãƒŠãƒ¼</option>
                </select>
                <button type="submit" class="btn btn-secondary">è¿½åŠ </button>
            </form>
        </div>
        
        <!-- Subscription -->
        <div class="card">
            <h3 class="mb-3">èª²é‡‘æƒ…å ±</h3>
            {% if shop.subscription %}
            <table class="table" style="margin: 0;">
                <tr>
                    <th style="width: 150px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                    <td>
                        <span class="badge badge-{% if shop.subscription.is_active %}success{% elif shop.subscription.is_past_due %}warning{% else %}danger{% endif %}">
                            {{ shop.subscription.status_label }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <th>ãƒ—ãƒ©ãƒ³</th>
                    <td>{{ shop.subscription.plan | upper }}</td>
                </tr>
                <tr>
                    <th>Stripe Customer</th>
                    <td>{{ shop.subscription.stripe_customer_id or 'âˆ’' }}</td>
                </tr>
            </table>
            {% else %}
            <p class="text-muted">ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æœªè¨­å®š</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
